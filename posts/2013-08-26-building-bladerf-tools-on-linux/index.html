<!doctype html>
<html ⚡ lang="ja-jp">
  <head>
    <meta charset="utf-8" />
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script>

    
    <title>bladeRF用のツールとライブラリをLinuxでビルドする</title>

    
    




  
  <meta name="author" content="TT" />
  <meta name="description" content="" />

  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@edy555" />
  <meta name="twitter:title" content="Computer &amp; RF Technology" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:image" content="https://ttrf.tk/img/avatar.jpg" />




<meta name="generator" content="Hugo 0.54.0">


<link rel="canonical" href="https://ttrf.tk/posts/2013-08-26-building-bladerf-tools-on-linux/">
<link rel="alternative" href="/index.xml" title="Computer &amp; RF Technology" type="application/atom+xml">


<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="format-detection" content="telephone=no,email=no,adress=no" />


<meta name="robots" content="index,follow" />
<meta name="referrer" content="origin-when-cross-origin" />




<link rel="icon" href="/img/favicon.ico" />
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" sizes="120x120" href="/img/avatar.jpg">



<link rel="stylesheet" href="/css/nostalgia.css">





  <link rel="stylesheet" href="/css/fork-awesome.min.css">


  </head>
  <body>
    
    <div id="contain">
	  

<div id="sidebar" class="sidebar">
  <section class="first odd">

    
      <h1><a href="https://ttrf.tk">Computer &amp; RF Technology</a></h1>
    

	  <h4>About</h4>
      
        SDRや測定器などソフトウェア寄りのRF実験についてのメモです。キット頒布中。
      
  </section>



  <section class="odd">
  
      <a target="_blank" href="https://github.com/ttrftech" title="ttrftech"><i class="fa fa-github fa-2x"></i></a>
      
      
      <a target="_blank" href="https://twitter.com/edy555" title="edy555"><i class="fa fa-twitter fa-2x"></i></a>
      
         
      
      
      
      
      
      
      
      

    
      <a href="https://ttrf.tk/index.xml" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-2x"></i></a>
        <ul class="sidebar-nav"></ul>
    </section>
  

  
    
      <section id="menu" class="odd">
        
          <h4>Special Pages</h4>
        
        <ul class="sidebar-nav">
        
          <li class="sidebar-nav-item">
            <a href="https://ttrf.tk/kit/adsbamp" title="ADS-Bプリアンプキット" >ADS-Bプリアンプキット</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://ttrf.tk/kit/centsdr" title="CentSDRキット" >CentSDRキット</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://ttrf.tk/kit/hfconv/" title="HFCONVキット" >HFCONVキット</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://ttrf.tk/kit/lpclink2bb/" title="LPC-Link2ブレイクアウトボード" >LPC-Link2ブレイクアウトボード</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://ttrf.tk/kit/nanovna/" title="NanoVNAキット" >NanoVNAキット</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://ttrf.tk/tags/" title="Tags" >Tags</a>
          </li>
        
        </ul>
      </section>
    
  

  
    
      <section id="menu" class="odd">
        
          <h4>Links</h4>
        
        <ul class="sidebar-nav">
        
          <li class="sidebar-nav-item">
            <a href="https://www.amazon.co.jp/gp/product/B00M6LTKNE/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00M6LTKNE&amp;linkCode=as2&amp;tag=fromsapporo07-22" title="HFコンバータ完成品" >HFコンバータ完成品</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://astore.amazon.co.jp/ttrftech-22" title="関連アイテム一覧" >関連アイテム一覧</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://www.amazon.co.jp/gp/product/B00F9COA64/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00F9COA64&amp;linkCode=as2&amp;tag=ttrftech-22" title="記事掲載:トラ技 2013年11月号" >記事掲載:トラ技 2013年11月号</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://www.amazon.co.jp/gp/product/B008CMZLQG/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B008CMZLQG&amp;linkCode=as2&amp;tag=ttrftech-22" title="記事掲載:トラ技 2014年6月号" >記事掲載:トラ技 2014年6月号</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://www.amazon.co.jp/gp/product/B00VS238YY/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00VS238YY&amp;linkCode=as2&amp;tag=ttrftech-22" title="特集執筆:Interface 2015年7月号" >特集執筆:Interface 2015年7月号</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://www.amazon.co.jp/gp/product/B010TMHK06/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B010TMHK06&amp;linkCode=as2&amp;tag=fromsapporo07-22" title="連載記事:Interface 2015年10月号〜2016年8月号" >連載記事:Interface 2015年10月号〜2016年8月号</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://www.amazon.co.jp/gp/product/B06XN73MWK/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B06XN73MWK&amp;linkCode=as2&amp;tag=ttrftech-22" title="特集分担:Interface 2017年6月号" >特集分担:Interface 2017年6月号</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://amzn.to/2Ss0YWr" title="特集分担:Interface 2018年9月号" >特集分担:Interface 2018年9月号</a>
          </li>
        
          <li class="sidebar-nav-item">
            <a href="https://amzn.to/2RiOqyS" title="特集執筆:RFワールドNo.44" >特集執筆:RFワールドNo.44</a>
          </li>
        
        </ul>
      </section>
    
  
	  

  
  
    
      <section class="even">
        <h4>Recent Posts</h4>
        <ul id="recent_posts"  class="sidebar-nav">
          
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2018-10-28-gnuradio-grc-rfworld-no44/">GNU Radioの入門に是非！解説記事をRFワールドNo44特集「GRCで広がるSDRの世界」に寄稿しました</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2018-07-27-centsdr-lcd-panel/">CentSDRに使えるLCDパネルのバリエーション</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2018-07-01-centsdr-kit-2nd-lot/">CentSDR 2nd lotをキット頒布します</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2018-04-23-gnuradio-osx-with-homebrew/">GNURadioをOSX&#43;Homebrewで整備してみました</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2018-02-11-centsdr-powermeter-frequency-response-and-linerinity/">CentSDRのパワーメータの周波数特性と直線性を測定してみた</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2018-02-04-centsdr-fm-broadcasting-reception/">CentSDRでFMラジオが受信できるようになりました</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2018-01-20-rfworld-workshop-meeting-2018/">RFワールド Workshop&amp;Meeting 2018で話します</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2018-01-17-centsdr-rf-power-meter/">CentSDRにパワーメータを付けてみました</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2018-01-11-centsdr-parts-kit/">CentSDRのキットを頒布します</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2017-11-19-makerfaireshenzhen2017/">深圳のMakerFaire Shenzhen 2017に行ってきました</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2017-11-04-centsdr-spectrum-and-waveform-display/">CentSDRでスペクトラムに加えて波形も表示するようにしてみた</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2017-10-09-dcoffset-rejection-from-adc-and-cmsis-dsp-library/">CentSDRの信号処理におけるDCオフセット補償</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2017-09-18-plotting-airrace-tracklog-with-rtl-sdr/">RTL-SDRでエアレース機のADS-Bメッセージを受信し、飛行軌跡をJupyterとpandasでGeoJSONに変換してプロットしてみる</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2017-08-15-centsdr-stm32-based-standalone-receiver/">CentSDRを組み立ててみました</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2017-08-04-centsdr-mcu-based-standalone-sdr-receiver/">ワンボードSDR CentSDRを試作中です</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2017-02-25-hmc472-digital-step-attenuator-and-nanosg/">HMC472ステップアッテネータチップを試してみる</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2017-02-19-limesdr-in-the-aluminium-box/">LimeSDRをケースにいれてみました</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2017-02-09-limesdr-unboxing-and-using-with-gqrx/">LimeSDRをGQRXで使ってみる</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2017-02-05-as5600-magnet-rotary-hall-sensor/">ロータリホールセンサAS5600を試用してみる</a>
              </li>
            
          
            
              <li class="post sidebar-nav-item">
                <a href="/posts/2017-01-15-measure-crystal-filter-with-nanovna/">NanoVNAでクリスタルフィルタの特性を見てみる</a>
              </li>
            
          
        </ul>
      </section>
    
  

  
<a class="twitter-timeline" data-height="800" href="https://twitter.com/edy555?ref_src=twsrc%5Etfw">Tweets by edy555</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  
</div>

	  
<div id="contain">
  <div id="content">
    <div class="regular">
      <article class="hentry" role="article">
		<time class="date">Monday, Aug 26, 2013</time>
<h2><a href="https://ttrf.tk/posts/2013-08-26-building-bladerf-tools-on-linux/" class="title">bladeRF用のツールとライブラリをLinuxでビルドする</a></h2>


        

        <div class="entry-content">
          
          
          
          <p>bladeRFのホスト用のソフトウェアはソースからビルドする必要があります。8/25に開発バージョンがマージされて若干手順が変わりました。アップデートされたバージョンではlibusbがサポートされました。デフォルトではこちらが有効になり、カーネルドライバが不要になりました。新しいバージョン向けに手順をまとめておきます。</p>

<p>使用した環境はUbuntu 13.04です。あらかじめ開発用ツール群をインストールしておきます。</p>

<pre><code class="language-bash">$ sudo apt-get install build-essential
</code></pre>

<p><a href="https://github.com/Nuand/bladeRF/tree/master/host" target="_blank">https://github.com/Nuand/bladeRF/tree/master/host</a> に記載されている手順に従ってコンパイルを進めます。まず、必要なツールと依存ライブラリをインストールしておきます。</p>

<pre><code class="language-bash">$ sudo apt-get install libusb-1.0.0 libusb-1.0.0-dev cmake
</code></pre>

<p>コマンドインタラクティブモードをサポートするためのオプションのライブラリをインストールしておきます。</p>

<pre><code class="language-bash">$ sudo apt-get install libtecla1-dev
</code></pre>

<p>bladeRFソースコードをgithubから取得します。</p>

<pre><code class="language-bash">$ git clone https://github.com/Nuand/bladeRF.git
</code></pre>

<p>hostディレクトリで、cmakeしてmake, make installします。</p>

<pre><code class="language-bash">$ cd bladeRF/host
$ mkdir build
$ cd build
$ cmake ../
$ make
$ sudo make install
</code></pre>

<p>共有ライブラリがインストールされるのでldconfigを実行しておきます。</p>

<pre><code class="language-bash">$ sudo ldconfig
</code></pre>

<p>さて、いよいよ実行ですが、bladeRF-cliコマンドからbladeRFが認識されるかどうか試してみます。内部コマンドprobeやversionで各情報が表示されます。</p>

<pre><code class="language-bash">$ bladeRF-cli
bladeRF&gt; probe

    Backend:        libusb
    Serial:         
    USB Bus:        1
    USB Address:    19

bladeRF&gt; version

Serial #: ba5054da746a5f1a3f7e8516447afd75
VCTCXO DAC calibration: 0x996b
FPGA size: 40 KLE
Firmware version: 1.1
FPGA version:     0.0

bladeRF&gt; quit
</code></pre>

<p>動作させるためにはFPGAへのロードが必要です。ファイルをダウンロードしておきます。</p>

<pre><code class="language-bash">$ wget http://nuand.com/fpga/ddc81d0fb1b653227b5824d8d5fcb444556da175/hostedx40.rbf
</code></pre>

<p>bladeRF-cliコマンドでFPGAファイルをロードしてみます。うまく行けば、bladeRFボード上に三つ並んだLEDが点滅し始めるはずです。</p>

<pre><code class="language-bash">$ bladeRF-cli -l hostedx40.rbf
Loading fpga...
Done.
bladeRF&gt; 
</code></pre>

<p>help setコマンドで設定可能なパラメータの一覧が表示されます。</p>

<pre><code class="language-bash">bladeRF&gt; help set

set 

The set command takes a parameter and an arbitrary number of
arguments for that particular command.  The parameter is one
of:

   bandwidth       Bandwidth settings
   config          Overview of everything
   frequency       Frequency settings
   lmsregs         LMS6002D register dump
   loopback        Loopback settings
   mimo            MIMO settings
   pa              PA settings
   pps             PPS settings
   refclk          Reference clock settings
   rxvga1          Gain setting of RXVGA1 in dB (range: )
   rxvga2          Gain setting of RXVGA2 in dB (range: )
   samplerate      Samplerate settings
   trimdac         VCTCXO Trim DAC settings
   txvga1          Gain setting of TXVGA1 in dB (range: )
   txvga2          Gain setting of TXVGA2 in dB (range: )

bladeRF&gt; 
</code></pre>

<p>次のような操作をすると受信を開始して、サンプルをファイルに保存できます。</p>

<pre><code class="language-bash">bladeRF&gt; set frequency 1000000000
bladeRF&gt; set samplerate 1000000
bladeRF&gt; rx config file=samples.bin format=bin n=10000
bladeRF&gt; rx start
bladeRF&gt; quit
</code></pre>

<p>ファイルが生成されることを確認しておきます。</p>

<pre><code class="language-bash">$ ls -ln samples.bin
-rw-rw-r-- 1 1000 1000 40960 Aug 27 02:02 samples.bin
</code></pre>

<p>もしファームウェアのバージョンが低いと表示された場合には、下記のようにFX3のバイナリイメージをダウンロードして、-fオプションでフラッシュへ書き込んでおきます。</p>

<pre><code class="language-bash">$ wget http://nuand.com/fx3/latest.img
$ bladeRF-cli -b -f latest.img
</code></pre>

<p>はまったポイントとして、前のバージョンでは共有ライブラリlibbladeRF.soが、/usr/libにインストールされていたのですが、新しいバージョンでは/usr/local/libに変更されていました。新しいのに差し替えた際に、場所が違うため上書きされず前のものが残っていたため、bladeRF-cliを動かしたときに古い共有ライブラリがロードされ、動作せずに悩みました。/usr/lib/libbladeRF.soを消してldconfigし直すことで解決しました。</p>

<p>次はgnuradioのセットアップです。最新のgnuradio-3.7.1をインストールするために、ディストリビューションに含まれているものではなく、<a href="http://nuand.com/forums/viewtopic.php?f=9&amp;t=2804#p3397" target="_blank">http://nuand.com/forums/viewtopic.php?f=9&amp;t=2804#p3397</a> の後半に記載されている手順に従い、スクリプトをダウンロードして自動的にセットアップを行います。</p>

<pre><code class="language-bash">$ mkdir gnuradio-build
$ cd gnuradio-build
$ wget http://www.sbrac.org/files/build-gnuradio
$ chmod +x build-gnuradio
$ ./build-gnuradio -m prereqs gitfetch
</code></pre>

<p>つづいて、gr-osmosdrです。ソースをgitで取得してcmakeします。</p>

<pre><code class="language-bash">$ git clone git://git.osmocom.org/gr-osmosdr
$ cd gr-osmosdr/
$ mkdir build
$ cd build
$ cmake ..
</code></pre>

<p>このときbladeRFのサポートが入ることを確認します。</p>

<pre><code class="language-bash">\-- ######################################################

-- # gr-osmosdr enabled components                         
-- ######################################################
...
--   \* nuand bladeRF
</code></pre>

<p>ここでmakeしますが、なんと現段階ではまだgr-osmosdrが新しいbladeRFのライブラリの変更に対応していないようです。なのでmakeに失敗してしまいます。というわけで、現時点では配布されているソースではbladeRFをgnuradioからは利用できなくなっています。libusb対応が入る前の版では使えていたのにもかかわらず残念です。</p>

<p>また状況が変化したら追記したいと思います。</p>
        </div>
        

<footer class="post-footer">
  <p class="meta">
    <span class="byline author vcard">Posted by <span class="fn">TT</span></span>
    
    at <time>Aug 26, 2013</time>
	<a href="https://ttrf.tk/posts/2013-08-26-building-bladerf-tools-on-linux/" class="permalink">Permalink ∞</a>
    
      <span class="categories">
        Tags:
        
          <a class="category" href="https://ttrf.tk/tags/bladerf">bladerf</a>  <a class="category" href="https://ttrf.tk/tags/gnuradio">gnuradio</a>  <a class="category" href="https://ttrf.tk/tags/sdr">sdr</a>  
    
    </span>
  </p>

<iframe src="https://www.facebook.com/plugins/like.php?href=https%3a%2f%2fttrf.tk%2fposts%2f2013-08-26-building-bladerf-tools-on-linux%2f&amp;send=false&amp;layout=button_count&amp;width=75&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;font&amp;height=20&amp;locale=en_US" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:75px; height:20px;"></iframe>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://ttrf.tk/posts/2013-08-26-building-bladerf-tools-on-linux/" data-text="bladeRF用のツールとライブラリをLinuxでビルドする" data-via="edy555">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<a href="https://b.hatena.ne.jp/entry/https://ttrf.tk/posts/2013-08-26-building-bladerf-tools-on-linux/" class="hatena-bookmark-button" data-hatena-bookmark-title="Computer RF Tech" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>

</footer>

		
		
		<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
      
      
      
      if (window.location.hostname == "localhost")
          return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'ttrftech';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

		
		
      </article>
    </div>
  </div>
</div>

	</div>
        <div id="footer">
      <p>Copyright &copy; 2019 TT - <a href="https://ttrf.tk/license/">License</a> -
        <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a>.
      </p>
    </div>

    
      <script>
        var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
        (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)}(document,'script'));
      </script>
    
  </body>
</html>

  </body>
</html>
